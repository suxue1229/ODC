var BMapLib=window.BMapLib=BMapLib||{};(function(){var i,n=i=n||{version:"1.3.8"};(function(){n.guid="$BAIDU$";window[n.guid]=window[n.guid]||{};n.dom=n.dom||{};n.dom.g=function(n){return"string"==typeof n||n instanceof String?document.getElementById(n):n&&n.nodeName&&(n.nodeType==1||n.nodeType==9)?n:null};n.g=n.G=n.dom.g;n.dom.getDocument=function(t){return t=n.dom.g(t),t.nodeType==9?t:t.ownerDocument||t.document};n.lang=n.lang||{};n.lang.isString=function(n){return"[object String]"==Object.prototype.toString.call(n)};n.isString=n.lang.isString;n.dom._g=function(t){return n.lang.isString(t)?document.getElementById(t):t};n._g=n.dom._g;n.browser=n.browser||{};/msie (\d+\.\d)/i.test(navigator.userAgent)&&(n.browser.ie=n.ie=document.documentMode||+RegExp.$1);n.dom.getComputedStyle=function(t,i){t=n.dom._g(t);var u=n.dom.getDocument(t),r;return u.defaultView&&u.defaultView.getComputedStyle&&(r=u.defaultView.getComputedStyle(t,null),r)?r[i]||r.getPropertyValue(i):""};n.dom._styleFixer=n.dom._styleFixer||{};n.dom._styleFilter=n.dom._styleFilter||[];n.dom._styleFilter.filter=function(t,i,r){for(var f=0,e=n.dom._styleFilter,u;u=e[f];f++)(u=u[r])&&(i=u(t,i));return i};n.string=n.string||{};n.string.toCamelCase=function(n){return n.indexOf("-")<0&&n.indexOf("_")<0?n:n.replace(/[-_][^-_]/g,function(n){return n.charAt(1).toUpperCase()})};n.dom.getStyle=function(t,i){var f=n.dom,u,r;return t=f.g(t),i=n.string.toCamelCase(i),u=t.style[i]||(t.currentStyle?t.currentStyle[i]:"")||f.getComputedStyle(t,i),u||(r=f._styleFixer[i],r&&(u=r.get?r.get(t):n.dom.getStyle(t,r))),(r=f._styleFilter)&&(u=r.filter(i,u,"get")),u};n.getStyle=n.dom.getStyle;/opera\/(\d+\.\d)/i.test(navigator.userAgent)&&(n.browser.opera=+RegExp.$1);n.browser.isWebkit=/webkit/i.test(navigator.userAgent);n.browser.isGecko=/gecko/i.test(navigator.userAgent)&&!/like gecko/i.test(navigator.userAgent);n.browser.isStrict=document.compatMode=="CSS1Compat";n.dom.getPosition=function(t){t=n.dom.g(t);var u=n.dom.getDocument(t),f=n.browser,e=n.dom.getStyle,a=f.isGecko>0&&u.getBoxObjectFor&&e(t,"position")=="absolute"&&(t.style.top===""||t.style.left===""),r={left:0,top:0},l=f.ie&&!f.isStrict?u.body:u.documentElement,i,o;if(t==l)return r;if(t.getBoundingClientRect){o=t.getBoundingClientRect();r.left=Math.floor(o.left)+Math.max(u.documentElement.scrollLeft,u.body.scrollLeft);r.top=Math.floor(o.top)+Math.max(u.documentElement.scrollTop,u.body.scrollTop);r.left-=u.documentElement.clientLeft;r.top-=u.documentElement.clientTop;var s=u.body,h=parseInt(e(s,"borderLeftWidth")),c=parseInt(e(s,"borderTopWidth"));f.ie&&!f.isStrict&&(r.left-=isNaN(h)?2:h,r.top-=isNaN(c)?2:c)}else{i=t;do{if(r.left+=i.offsetLeft,r.top+=i.offsetTop,f.isWebkit>0&&e(i,"position")=="fixed"){r.left+=u.body.scrollLeft;r.top+=u.body.scrollTop;break}i=i.offsetParent}while(i&&i!=t);for((f.opera>0||f.isWebkit>0&&e(t,"position")=="absolute")&&(r.top-=u.body.offsetTop),i=t.offsetParent;i&&i!=u.body;)r.left-=i.scrollLeft,f.opera&&i.tagName=="TR"||(r.top-=i.scrollTop),i=i.offsetParent}return r};n.event=n.event||{};n.event._listeners=n.event._listeners||[];n.event.on=function(t,i,r){i=i.replace(/^on/i,"");t=n.dom._g(t);var u=function(n){r.call(t,n)},s=n.event._listeners,e=n.event._eventFilter,o,f=i;return i=i.toLowerCase(),e&&e[i]&&(o=e[i](t,i,u),f=o.type,u=o.listener),t.addEventListener?t.addEventListener(f,u,!1):t.attachEvent&&t.attachEvent("on"+f,u),s[s.length]=[t,i,r,u,f],t};n.on=n.event.on,function(){var t=window[n.guid];n.lang.guid=function(){return"TANGRAM__"+(t._counter++).toString(36)};t._counter=t._counter||1}();window[n.guid]._instances=window[n.guid]._instances||{};n.lang.isFunction=function(n){return"[object Function]"==Object.prototype.toString.call(n)};n.lang.Class=function(t){this.guid=t||n.lang.guid();window[n.guid]._instances[this.guid]=this};window[n.guid]._instances=window[n.guid]._instances||{};n.lang.Class.prototype.dispose=function(){delete window[n.guid]._instances[this.guid];for(var t in this)n.lang.isFunction(this[t])||delete this[t];this.disposed=!0};n.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};n.lang.Event=function(n,t){this.type=n;this.returnValue=!0;this.target=t||null;this.currentTarget=null};n.lang.Class.prototype.addEventListener=function(t,i,r){if(n.lang.isFunction(i)){this.__listeners||(this.__listeners={});var f=this.__listeners,u;if(typeof r=="string"&&r)if(/[^\w\-]/.test(r))throw"nonstandard key:"+r;else i.hashCode=r,u=r;t.indexOf("on")!=0&&(t="on"+t);typeof f[t]!="object"&&(f[t]={});u=u||n.lang.guid();i.hashCode=u;f[t][u]=i}};n.lang.Class.prototype.removeEventListener=function(t,i){var r,u;if((typeof i=="undefined"||(!n.lang.isFunction(i)||(i=i.hashCode))&&n.lang.isString(i))&&(this.__listeners||(this.__listeners={}),t.indexOf("on")!=0&&(t="on"+t),r=this.__listeners,r[t]))if(typeof i!="undefined")r[t][i]&&delete r[t][i];else for(u in r[t])delete r[t][u]};n.lang.Class.prototype.dispatchEvent=function(t,i){var u,f,r;n.lang.isString(t)&&(t=new n.lang.Event(t));this.__listeners||(this.__listeners={});i=i||{};for(u in i)t[u]=i[u];if(f=this.__listeners,r=t.type,t.target=t.target||this,t.currentTarget=this,r.indexOf("on")!=0&&(r="on"+r),n.lang.isFunction(this[r])&&this[r].apply(this,arguments),typeof f[r]=="object")for(u in f[r])f[r][u].apply(this,arguments);return t.returnValue};n.lang.inherits=function(n,t,i){var r,u,f=n.prototype,e=new Function;e.prototype=t.prototype;u=n.prototype=new e;for(r in f)u[r]=f[r];n.prototype.constructor=n;n.superClass=t.prototype;"string"==typeof i&&(u._className=i)};n.inherits=n.lang.inherits})();var r="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/images/m",u="png",t=BMapLib.TextIconOverlay=function(n,t,i){this._position=n;this._text=t;this._options=i||{};this._styles=this._options.styles||[];this._styles.length||this._setupDefaultStyles()};i.lang.inherits(t,BMap.Overlay,"TextIconOverlay");t.prototype._setupDefaultStyles=function(){for(var i=[53,56,66,78,90],n=0,t;t=i[n];n++)this._styles.push({url:r+n+"."+u,size:new BMap.Size(t,t)})};t.prototype.initialize=function(n){return this._map=n,this._domElement=document.createElement("div"),this._updateCss(),this._updateText(),this._updatePosition(),this._bind(),this._map.getPanes().markerMouseTarget.appendChild(this._domElement),this._domElement};t.prototype.draw=function(){this._map&&this._updatePosition()};t.prototype.getText=function(){return this._text};t.prototype.setText=function(n){n&&(!this._text||this._text.toString()!=n.toString())&&(this._text=n,this._updateText(),this._updateCss(),this._updatePosition())};t.prototype.getPosition=function(){return this._position};t.prototype.setPosition=function(n){!n||this._position&&this._position.equals(n)||(this._position=n,this._updatePosition())};t.prototype.getStyleByText=function(n,t){var r=parseInt(n),i=parseInt(r/10);return i=Math.max(0,i),i=Math.min(i,t.length-1),t[i]};t.prototype._updateCss=function(){var n=this.getStyleByText(this._text,this._styles);this._domElement.style.cssText=this._buildCssText(n)};t.prototype._updateText=function(){this._domElement&&(this._domElement.innerHTML=this._text)};t.prototype._updatePosition=function(){if(this._domElement&&this._position){var n=this._domElement.style,t=this._map.pointToOverlayPixel(this._position);t.x-=Math.ceil(parseInt(n.width)/2);t.y-=Math.ceil(parseInt(n.height)/2);n.left=t.x+"px";n.top=t.y+"px"}};t.prototype._buildCssText=function(n){var o=n.url,u=n.size,t=n.anchor,f=n.offset,s=n.textColor||"black",h=n.textSize||10,r=[],e;return i.browser.ie<7?r.push('filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+o+'");'):(r.push("background-image:url("+o+");"),e="0 0",f instanceof BMap.Size&&(e=f.width+"px "+f.height+"px"),r.push("background-position:"+e+";")),u instanceof BMap.Size&&(t instanceof BMap.Size?(t.height>0&&t.height<u.height&&r.push("height:"+(u.height-t.height)+"px; padding-top:"+t.height+"px;"),t.width>0&&t.width<u.width&&r.push("width:"+(u.width-t.width)+"px; padding-left:"+t.width+"px;")):(r.push("height:"+u.height+"px; line-height:"+u.height+"px;"),r.push("width:"+u.width+"px; text-align:center;"))),r.push("cursor:pointer; color:"+s+"; position:absolute; font-size:"+h+"px; font-family:Arial,sans-serif; font-weight:bold"),r.join("")};t.prototype._bind=function(){function r(n,t){var o=n.srcElement||n.target,f=n.clientX||n.pageX,e=n.clientY||n.pageY,r;return n&&t&&f&&e&&o&&(r=i.dom.getPosition(u.getContainer()),t.pixel=new BMap.Pixel(f-r.left,e-r.top),t.point=u.pixelToPoint(t.pixel)),t}if(this._domElement){var n=this,u=this._map,t=i.lang.Event;i.event.on(this._domElement,"mouseover",function(i){n.dispatchEvent(r(i,new t("onmouseover")))});i.event.on(this._domElement,"mouseout",function(i){n.dispatchEvent(r(i,new t("onmouseout")))});i.event.on(this._domElement,"click",function(i){n.dispatchEvent(r(i,new t("onclick")))});i.event.on(this._domElement,"touchend",function(i){n.dispatchEvent(r(i,new t("onclick")))})}}})();